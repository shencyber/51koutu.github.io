webpackJsonp([1],{0:function(e,t){},1:function(e,t){},"7QVd":function(e,t){},K5yB:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("7+uW"),n={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var a=r("VU/8")({name:"App"},n,!1,function(e){r("K5yB")},null,null).exports,c=r("/ocq"),l={name:"HelloWorld",data:function(){return{total:0,uploadImgArr:[],successNum:0,errorImgArr:[],locked:!1,downLoadLocked:!1,baseArr:[]}},created:function(){},methods:{handleSuccess:function(e,t){++this.total,console.log("success",e);var r=this.uploadImgArr.push({originUrl:e.data.originUrl,executeUrl:null,name:e.data.name});this.kt(e.data.originUrl,r-1)},handleError:function(e,t,r){console.error("error",t)},formatError:function(e,t){this.$Notice.error({desc:"文件格式错误，请上传图片"})},exceededSizeError:function(e,t){this.$Notice.error({desc:"图像大小不超过3M"})},kt:function(e,t){var r=this;console.log("this.total",this.total);e="http://localhost:3001/kt?url="+e;this.$axios.get(e).then(function(e){console.log("res",e,"index",t);var o=e.data.Data;r.uploadImgArr[t].executeUrl=o.executeUrl,r.successNum++}).catch(function(e){r.errorImgArr.push(t)})},confirm:function(){var e=this;if(this.locked)this.$Notice.info({desc:"求照片处理中"});else{console.clear(),this.locked=!0,console.error("locked");var t=0;!function r(){if(!e.errorImgArr.length)return console.clear(),console.log(e.uploadImgArr),void(e.locked=!1);var o=e.uploadImgArr[e.errorImgArr[t]],n="http://localhost:3001/kt?url="+o.originUrl;console.log("需要处理的照片",o.originUrl),e.$axios.get(n).then(function(o){var n=o.data.Data;console.log(e.errorImgArr[t],"get result",n.executeUrl),e.uploadImgArr[e.errorImgArr[t]].executeUrl=n.executeUrl,console.log("get it",n.executeUrl),console.log("原始数据",e.uploadImgArr[e.errorImgArr[t]]),e.errorImgArr.splice(t,1),console.log("confirm success , 还剩下",e.errorImgArr.length),e.successNum++,r()}).catch(function(o){if(console.log("confirm error",o),!(t+1<=e.errorImgArr.length))return console.log("end"),void(e.locked=!1);++t,console.log("start chnage",t),r()})}()}},getBase64Image:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height),t.toDataURL()},dataURLtoBlob:function(e){for(var t=e.split(","),r=t[0].match(/:(.*?);/)[1],o=atob(t[1]),n=o.length,a=new Uint8Array(n);n--;)a[n]=o.charCodeAt(n);return new Blob([a],{type:r})},zipclick:function(e){for(var t=this,o=new(r("WgY6")),n=0,a=e.length;n<a;n++)o.file(e[n].name,e[n].content,{base64:!0});o.generateAsync({type:"blob"}).then(function(o){r("t4zo")(o,String((new Date).getTime())+String(Math.floor(1e3*Math.random()+1))+"-"+e.length+".zip"),t.downLoadLocked=!1,t.$Notice.close("download"),t.$Notice.success({desc:"下载成功"}),t.baseArr=[]})},startDownload:function(){var e=this;if(0!=this.uploadImgArr.length)if(this.downLoadLocked)this.$Notice.warning({desc:"正在努力下载"});else{this.downLoadLocked=!0,this.$Notice.info({desc:"图片下载中",name:"download",duration:0});for(var t=function(){var t=new Image;t.onload=function(){e.baseArr.push({content:e.dataURLtoBlob(e.getBase64Image(t)),name:t.name}),e.baseArr.length==e.uploadImgArr.length&&(console.log(e.baseArr),e.zipclick(e.baseArr))},t.crossOrigin="*",t.setAttribute("crossOrigin","Anonymous"),t.src=e.uploadImgArr[r].executeUrl,t.name=e.uploadImgArr[r].name},r=0,o=this.uploadImgArr.length;r<o;r++)t()}else this.$Notice.warning({desc:"请先上传图片"})}}},s={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"hello"},[r("Row",{attrs:{gutter:24}},[r("Col",{attrs:{span:"7"}},[r("div",{staticStyle:{"background-color":"#2d8cf0","border-radius":"4px"}},[r("b",[e._v("成功上传"),r("span",{staticStyle:{color:"red","font-size":"30px"}},[e._v(e._s(e.total))]),e._v("张")])])]),e._v(" "),r("Col",{attrs:{span:"7"}},[r("div",{staticStyle:{"background-color":"#19be6b","border-radius":"4px"}},[r("b",[e._v("成功处理"),r("span",{staticStyle:{color:"red","font-size":"30px"}},[e._v(e._s(e.successNum))]),e._v("张")])])]),e._v(" "),r("Col",{attrs:{span:"7"}},[r("div",{staticStyle:{"background-color":"#ed4014","border-radius":"4px"}},[r("b",[e._v("失败"),r("span",{staticStyle:{color:"#fff","font-size":"30px"}},[e._v(e._s(e.errorImgArr.length))]),e._v("张")]),e.errorImgArr.length?r("Button",{on:{click:e.confirm}},[e._v("重试")]):e._e()],1)]),e._v(" "),r("Col",{attrs:{span:"3"}},[r("div",[r("Button",{attrs:{color:"red",icon:"ios-cloud-download",size:"large",type:"warning",long:""},on:{click:e.startDownload}},[e._v("下载")])],1)])],1),e._v(" "),r("div",{staticStyle:{clear:"both","padding-bottom":"20px"}}),e._v(" "),r("Upload",{attrs:{multiple:"",type:"drag","max-size":"3072",accept:"image/jpg, image/jpeg,image/png",format:["jpg","jpeg","png"],"show-upload-list":!1,action:"/api/upload","on-success":e.handleSuccess,"on-error":e.handleError,"on-format-error":e.formatError,"on-exceeded-size":e.exceededSizeError}},[r("div",{staticStyle:{padding:"20px 0"}},[r("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),e._v(" "),r("p",[e._v("点击或拖拽上传图片,建议不超过200张")]),e._v(" "),r("small",[e._v("图像大小不超过3M,尺寸不超过2000X2000像素")])],1)]),e._v(" "),r("section",e._l(e.uploadImgArr,function(t,o){return r("div",{staticStyle:{float:"left"}},[r("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.originUrl}}),e._v(" "),r("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.executeUrl}})])}),0)],1)},staticRenderFns:[]};var i=r("VU/8")(l,s,!1,function(e){r("a83Q")},"data-v-6b787984",null).exports;o.default.use(c.a);var d=new c.a({routes:[{path:"/",name:"HelloWorld",component:i}]}),u=r("mtWM"),g=r.n(u),p=r("b3L9"),h=r.n(p);r("7QVd");o.default.config.productionTip=!1,o.default.use(g.a),o.default.use(d),o.default.use(h.a),o.default.prototype.$axios=g.a,new o.default({el:"#app",router:d,components:{App:a},template:"<App/>"})},a83Q:function(e,t){}},["NHnr"]);